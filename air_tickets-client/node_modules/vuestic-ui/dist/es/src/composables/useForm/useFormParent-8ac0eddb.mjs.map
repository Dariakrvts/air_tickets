{"version":3,"file":"useFormParent-8ac0eddb.mjs","sources":["../../../../../src/composables/useForm/useFormParent.ts"],"sourcesContent":["import { computed, provide, ref, type Ref } from 'vue'\nimport { FormServiceKey } from './consts'\nimport { Form, FormFiled } from './types'\nimport { useFormChild } from './useFormChild'\n\ntype FormParentOptions = {\n  hideLoading: boolean\n  hideErrors: boolean\n  hideErrorMessages: boolean\n}\n\nexport const createFormContext = <Names extends string>(options: FormParentOptions) => {\n  const fields: Ref<Record<number, Ref<FormFiled>>> = ref({})\n\n  return {\n    // Vue unwrap ref automatically, but types are not for some reason\n    fields: computed(() => Object.values(fields.value) as any as FormFiled<Names>[]),\n    doShowError: computed(() => !options.hideErrors),\n    doShowErrorMessages: computed(() => !options.hideErrorMessages),\n    doShowLoading: computed(() => !options.hideLoading),\n    registerField: (uid: number, field: Ref<FormFiled>) => {\n      fields.value[uid] = field\n    },\n    unregisterField: (uid: number) => {\n      delete fields.value[uid]\n    },\n  }\n}\n\nexport const useFormParent = <Names extends string = string>(options: FormParentOptions): Form<Names> => {\n  const formContext = createFormContext<Names>(options)\n\n  provide(FormServiceKey, formContext)\n\n  const { fields } = formContext\n\n  const fieldNames = computed(() => fields.value.map((field) => field.name).filter(Boolean) as Names[])\n  const formData = computed(() => fields.value.reduce((acc, field) => {\n    if (field.name) { acc[field.name] = field.value }\n    return acc\n  }, {} as Record<Names, any>))\n  const isValid = computed(() => fields.value.every((field) => field.isValid))\n  const isLoading = computed(() => fields.value.some((field) => field.isLoading))\n  const errorMessages = computed(() => fields.value.map((field) => field.errorMessages).flat())\n  const errorMessagesNamed = computed(() => fields.value.reduce((acc, field) => {\n    if (field.name) { acc[field.name] = field.errorMessages }\n    return acc\n  }, {} as Record<Names, any>))\n\n  const validate = () => {\n    // Validate each filed to get the error messages\n    return fields.value.reduce((acc, field) => {\n      return field.validate() && acc\n    }, true)\n  }\n\n  const validateAsync = () => {\n    return Promise.all(fields.value.map((field) => field.validateAsync())).then((results) => {\n      return results.every(Boolean)\n    })\n  }\n\n  const reset = () => {\n    fields.value.forEach((field) => field.reset())\n  }\n\n  const resetValidation = () => {\n    fields.value.forEach((field) => field.resetValidation())\n  }\n\n  const focus = () => {\n    fields.value[0]?.focus()\n  }\n\n  const focusInvalidField = () => {\n    const invalidField = fields.value.find((field) => !field.isValid)\n\n    invalidField?.focus()\n  }\n\n  useFormChild(() => ({\n    name: '',\n    value: undefined,\n    isValid: isValid.value,\n    isLoading: isLoading.value,\n    validate,\n    validateAsync,\n    reset,\n    resetValidation,\n    focus,\n    errorMessages: errorMessages.value,\n  }))\n\n  return {\n    formData,\n    fields,\n    fieldNames,\n    isValid,\n    isLoading,\n    errorMessages,\n    errorMessagesNamed,\n    validate,\n    reset,\n    resetValidation,\n    focus,\n    focusInvalidField,\n  }\n}\n"],"names":[],"mappings":"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"}